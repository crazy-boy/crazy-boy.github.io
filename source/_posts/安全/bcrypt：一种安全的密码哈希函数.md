---
title: bcrypt：一种安全的密码哈希函数
tags: [bcrypt,哈希算法,安全]
categories: [安全]
abbrlink: 'bcrypt'
date: 2024-03-18 10:25:00
updated: 2024-03-18 10:25:00
---

### bcrypt是什么？

bcrypt是一种基于Blowfish加密算法的密码哈希函数。它被广泛应用于存储用户密码，因其安全性高、易用性强而受到青睐。

### bcrypt的工作原理

bcrypt的工作原理可以概括为以下几点：

* **加盐：** 在对密码进行哈希计算之前，会随机生成一个盐值，并将其与密码进行组合。这个盐值是唯一的，每次哈希计算都会生成不同的盐值。
* **迭代次数：** bcrypt允许设置一个工作因子，这个因子决定了哈希函数的迭代次数。迭代次数越多，计算时间越长，破解难度也就越大。
* **自适应性：** bcrypt具有自适应性，随着硬件计算能力的提升，可以动态增加迭代次数，以保持破解难度不变。

### PHP 中 bcrypt 的实现：password\_hash() 和 password\_verify() 函数


PHP 从 5.5 版本开始内置了 `password_hash()` 和 `password_verify()` 函数，用于生成和验证 bcrypt 哈希值。

* **password\_hash() 函数**：

    * **功能：** 创建一个新的密码哈希。
    * **参数：**
        * `password`: 要哈希的密码。
        * `algo`: 算法标识符，通常使用 `PASSWORD_DEFAULT` 或 `PASSWORD_BCRYPT`。
        * `options`: 一个关联数组，包含额外的选项，如 `cost`（哈希计算的成本）。
    * **返回值：** 一个字符串，表示生成的哈希值。

* **password\_verify() 函数**：

    * **功能：** 验证一个密码是否与一个已有的哈希值匹配。
    * **参数：**
        * `password`: 要验证的密码。
        * `hash`: 之前使用 `password_hash()` 生成的哈希值。
    * **返回值：** 如果密码匹配，返回 `true`，否则返回 `false`。

<!-- end list -->

```php
<?php
// 生成一个 bcrypt 哈希
$password = 'mypassword';
$options = [
    'cost' => 12, // 调整成本参数，值越大，计算越耗时
];
$hash = password_hash($password, PASSWORD_DEFAULT, $options);

// 验证密码
if (password_verify($password, $hash)) {
    echo '密码正确';
} else {
    echo '密码错误';
}
```

### bcrypt的优势

* **安全性高：** 结合了加盐和可变工作因子，使得bcrypt对彩虹表攻击、字典攻击等具有很强的抵抗力。
* **易用性强：** bcrypt的实现相对简单，很多编程语言和数据库都提供了内置的bcrypt函数。
* **灵活性强：** 可以通过调整工作因子来适应不同的安全需求。

### bcrypt在密码存储中的应用

bcrypt常用于存储用户密码。当用户注册或修改密码时，系统会使用bcrypt对密码进行哈希计算，并将得到的哈希值存储在数据库中。当用户登录时，系统会再次对输入的密码进行哈希计算，并将结果与存储的哈希值进行比较。如果两者一致，则验证通过。

**为什么使用bcrypt存储密码比直接存储密码更安全？**

* **不可逆性：** 哈希函数是单向的，无法从哈希值反推出原始密码。
* **安全性高：** bcrypt的加盐和可变工作因子使得破解难度大大增加。
* **防止彩虹表攻击：** 由于盐值是随机生成的，彩虹表攻击变得无效。

### bcrypt的应用场景

* **用户认证：** 几乎所有需要用户登录的系统都会使用bcrypt来存储密码。
* **密码重置：** 在用户忘记密码时，系统会生成一个新的随机密码，并使用bcrypt进行哈希存储。
* **其他需要保护密码的场景：** 比如API认证、密钥存储等。

### 总结

bcrypt是一种非常安全的密码哈希函数，在保护用户密码方面发挥着重要作用。它的安全性、易用性和灵活性使其成为存储密码的首选方案。