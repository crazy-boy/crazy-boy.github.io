---
title: Redis中set、setex、setnx的用法和区别
tags: [Redis]
categories: [Redis]
abbrlink: 'redis-set-note'
date: 2023-05-16 12:38:00
updated: 2023-05-16 12:38:00
---

Redis是一个高性能的键值对数据库，提供了多种设置键值的方法。其中，`set`、`setex` 和 `setnx` 是最常用的三个命令，它们在设置键值方面各有特点。

### 1. set命令

* **功能：** 将字符串值 value 关联到 key。
* **语法：** `SET key value`
* **特点：**
    * **覆盖旧值：** 如果 key 已经存在，SET 命令会直接覆盖旧值。
    * **无过期时间：** 设置的键值没有默认的过期时间，除非手动设置。

### 2. setex命令

* **功能：** setex(=SET EXpire)是将值 value 关联到 key，并设置 key 的生存时间。
* **语法：** `SETEX key seconds value` ，该命令相当于将下面两行操作合并为一个原子操作
```
	set key value
	expire key seconds
```
* **特点：**
    * **设置过期时间：** seconds 参数指定了 key 的过期时间，单位为秒。
    * **覆盖旧值：** 如果 key 已经存在，SETEX 命令会覆盖旧值。

### 3. setnx命令

* **功能：** setnx(=SET if Not eXists)是将值 value 关联到 key，但只有当 key 不存在时才设置。
* **语法：** `SETNX key value`
* **特点：**
    * **原子性操作：** SETNX 是一个原子操作，如果 key 已经存在，则什么都不做。
    * **返回结果：** 如果设置成功，返回 1；否则返回 0。

### 三个命令的比较

| 命令 | 功能 | 特点 |
|---|---|---|
| SET | 设置键值 | 覆盖旧值，无默认过期时间 |
| SETEX | 设置键值并设置过期时间 | 覆盖旧值，设置过期时间 |
| SETNX | 设置键值，仅当键不存在时 | 原子操作，返回设置结果 |

### 使用场景

* **set命令：** 适合设置不需要过期时间的键值，例如缓存一些静态数据。
* **setex命令：** 适合设置有过期时间的键值，例如实现限时优惠、验证码等功能。
* **setnx命令：** 适合实现分布式锁、唯一标识生成等需要原子性的操作。

### 示例

```
# 设置一个键值对，没有过期时间
SET name "张三"

# 设置一个键值对，并设置过期时间为30秒
SETEX token 30 "123456"

# 只有在key不存在时才设置值
SETNX lock 1
```

### 总结

选择哪个命令取决于具体的业务场景。

* 如果需要设置一个永久有效的键值，使用 SET。
* 如果需要设置一个有过期时间的键值，使用 SETEX。
* 如果需要实现一个原子性的设置操作，使用 SETNX。

**注意：**

* Redis 中的所有键都是字符串类型，即使存储的是数字或其他类型的数据，也会被转换为字符串。
* 对于复杂的业务逻辑，可以结合 Redis 的其他数据结构和命令，例如哈希、列表、集合等，来实现更灵活的功能。